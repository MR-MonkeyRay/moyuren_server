<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘¸é±¼æ—¥å† {{ date.year_month }} - æ‚å¿—é£æ ¼ç‰ˆ</title>
    <!-- Google Fonts: æ€æºé»‘ä½“(æ­£æ–‡) + éœé¹œæ–‡æ¥·(æ ‡é¢˜) + Poppins(æ•°å­—/è‹±æ–‡) - ä½¿ç”¨å›½å†…é•œåƒ -->
    <link rel="preconnect" href="https://fonts.loli.net">
    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>
    <link href="https://fonts.loli.net/css2?family=JetBrains+Mono:wght@500;600;700&family=LXGW+WenKai:wght@400;700&family=Noto+Sans+SC:wght@400;500;700;900&family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* è«å…°è¿ª/æ‚å¿—é£é…è‰² */
            --bg-body: #E0E5EC;
            --bg-paper: #F7F9F9;

            --text-dark: #2C3E50;
            --text-grey: #7F8C8D;
            --text-light: #95A5A6;

            --accent-blue: #D6EAF8;
            --accent-blue-text: #2E86C1;

            --accent-green: #D5F5E3;
            --accent-green-text: #27AE60;

            --accent-pink: #FADBD8;
            --accent-pink-text: #C0392B;

            /* è‚¡ç¥¨æ¶¨è·Œé¢œè‰² - è«å…°è¿ªæŸ”å’Œç‰ˆ (WCAG AA compliant) */
            --color-up: #C0392B;
            --color-up-bg: rgba(192, 57, 43, 0.08);
            --color-down: #1E8449;
            --color-down-bg: rgba(30, 132, 73, 0.08);
            --color-flat: #7F8C8D;
            --color-flat-bg: #F7F9F9;

            --card-radius: 16px;
            --spacing: 16px;

            /* å­—ä½“ç³»ç»Ÿ */
            --font-body: 'Noto Sans SC', 'PingFang SC', 'Helvetica Neue', sans-serif;
            --font-title: 'LXGW WenKai', 'STKaiti', 'KaiTi', serif;
            --font-number: 'Poppins', 'Helvetica Neue', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        /* é˜²æº¢å‡ºä¿æŠ¤ */
        .moyu-text, .big-day, .term-name-cn, .h-num, .h-name, .week-pill, .days-num, .weekend-num, .news-num {
            white-space: nowrap;
            overflow: hidden;
        }
        .news-text, .history-content, .kfc-body {
            overflow-wrap: break-word;
            word-break: break-word;
        }

        body {
            background-color: var(--bg-body);
            font-family: var(--font-body);
            min-height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 22px 0;
        }

        /* æ ¸å¿ƒå®¹å™¨ï¼šé”å®šA4æ¯”ä¾‹ï¼Œé«˜åº¦è‡ªé€‚åº”å±å¹• */
        .poster {
            width: 90vw;
            max-width: 760px;
            min-height: 1030px;
            background-color: var(--bg-paper);
            border-radius: 8px;
            box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: var(--spacing);
            color: var(--text-dark);
        }

        /* é€šç”¨å¡ç‰‡é£æ ¼ - æŸ”å’Œæ‚¬æµ®é˜´å½± */
        .box {
            background: #FFFFFF;
            border-radius: var(--card-radius);
            padding: 20px;
            /* æŸ”å’Œæ‚¬æµ®é˜´å½±ï¼šæ¸…æ™°çš„å±‚æ¬¡æ„Ÿ */
            box-shadow:
                0 4px 16px rgba(0,0,0,0.06),
                0 8px 24px rgba(0,0,0,0.04),
                inset 0 1px 0 rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.8);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }

        .box:hover {
            box-shadow:
                0 6px 20px rgba(0,0,0,0.08),
                0 12px 32px rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,0.6);
            transform: translateY(-2px);
        }

        h2 {
            font-size: 20px;
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- ç¬¬ä¸€æ’ï¼šå¤´éƒ¨ (å›ºå®šé«˜åº¦) --- */
        .row-header {
            height: 170px;
            flex-shrink: 0;
            display: flex;
            gap: var(--spacing);
        }

        .title-card {
            flex: 0.35;
            background-color: var(--text-dark);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            /* æ ‡é¢˜å¡ç‰‡æ·±è‰²é˜´å½± */
            box-shadow:
                8px 8px 16px rgba(0,0,0,0.15),
                -4px -4px 10px rgba(255,255,255,0.5),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }
        .moyu-text {
            font-size: 45px; font-weight: 700; line-height: 1.1; letter-spacing: 4px;
            font-family: var(--font-title);
            /* æ ‡é¢˜æ–‡å­—é˜´å½± */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .moyu-sub {
            font-size: 14px; font-weight: 500; opacity: 0.9; margin-top: 8px; letter-spacing: 3px;
            font-family: var(--font-number);
        }

        .date-card {
            flex: 0.65;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        .date-left { display: flex; flex-direction: column; }
        .big-day {
            font-size: 80px; font-weight: 800; color: var(--text-dark); line-height: 1;
            font-family: var(--font-number);
            /* å¤§æ—¥æœŸæ•°å­—é˜´å½± */
            text-shadow: 3px 3px 6px rgba(44, 62, 80, 0.15);
        }
        .ym-text {
            font-size: 22px; color: var(--text-grey); font-weight: 500;
            font-family: var(--font-number);
        }

        .date-right { text-align: right; }
        .week-pill {
            background: var(--accent-blue); color: var(--accent-blue-text);
            padding: 6px 16px; border-radius: 20px; font-weight: bold; font-size: 18px;
            display: inline-block; margin-bottom: 8px;
            /* èƒ¶å›Šæ ‡ç­¾é˜´å½± */
            box-shadow:
                3px 3px 8px rgba(46, 134, 193, 0.2),
                -2px -2px 6px rgba(255,255,255,0.8),
                inset 0 1px 0 rgba(255,255,255,0.5);
        }
        .lunar-text { font-size: 16px; color: var(--text-grey); }
        
        .weekend-wrap { margin-top: 10px; font-size: 14px; color: var(--text-grey); display: flex; align-items: baseline; justify-content: flex-end; }
        .weekend-num { font-size: 20px; font-weight: 800; color: #E67E22; margin: 0 4px; }
        /* å‘¨æœ«å½“å¤©ç‰¹æ®Šæ ·å¼ - æ¸©æš–æè‰²ï¼Œæ…µæ‡’æƒ¬æ„ */
        .weekend-wrap.is-weekend {
            background: linear-gradient(135deg, #F5CBA7 0%, #E67E22 100%);
            padding: 8px 16px;
            border-radius: 12px;
            justify-content: center;
            font-weight: 600;
            color: white;
            box-shadow: 0 4px 12px rgba(230, 126, 34, 0.3);
            text-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }

        /* --- ç¬¬äºŒæ’ï¼šä¿¡æ¯ (å¼¹æ€§) --- */
        .row-info {
            min-height: 215px;
            flex-shrink: 0;
            display: flex;
            gap: var(--spacing);
        }

        .term-card {
            flex: 0.4;
            background: linear-gradient(135deg, #ffffff 0%, #fcfdfc 100%);
            display: flex;
            flex-direction: column;
        }
        .countdown-wrap {
            flex: 0 1 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-width: 0;
            width: 100%;
        }
        .term-name-cn {
            font-size: 32px; font-weight: 700; color: var(--accent-green-text); line-height: 1.2;
            font-family: var(--font-title);
            /* èŠ‚æ°”åç§°æ–‡å­—é˜´å½± */
            text-shadow: 1px 1px 3px rgba(39, 174, 96, 0.2);
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .term-name-en {
            font-size: 14px; color: var(--text-light); margin-bottom: 8px; font-weight: 500;
            font-family: var(--font-number);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            display: block;
        }
        .days-label {
            font-size: 16px;
            color: var(--text-grey);
            display: flex;
            align-items: baseline;
            justify-content: center;
            flex-wrap: wrap;
            column-gap: 2px;
            line-height: 1.4;
        }
        .days-num {
            font-size: 24px; font-weight: 700; color: var(--text-dark); margin: 0 4px;
            font-family: var(--font-number);
            /* æ•°å­—é˜´å½± */
            text-shadow: 1px 1px 2px rgba(44, 62, 80, 0.1);
        }
        /* èŠ‚æ°”å½“å¤©æ ·å¼ - é¼ å°¾è‰ç»¿ï¼Œè‡ªç„¶é›…è‡´ */
        .days-label.today {
            font-weight: 600;
            color: #2C3E50;
            background: linear-gradient(135deg, #A2D9CE 0%, #48C9B0 100%);
            padding: 6px 14px;
            border-radius: 20px;
            box-shadow:
                0 4px 12px rgba(72, 201, 176, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }

        .yi-ji-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 12px;
            border-top: 1px dashed #E5E7EB;
            padding-top: 8px;
            margin-top: auto;
            width: 100%;
            flex-shrink: 0;
        }
        .yi-ji-row > div {
            display: flex;
            align-items: flex-start;
            line-height: 1.3;
            white-space: normal;
        }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 11px;
            margin-right: 6px;
            font-weight: 600;
            flex-shrink: 0;
            height: fit-content;
            /* æ ‡ç­¾å¾®é˜´å½± */
            box-shadow: 1px 1px 3px rgba(0,0,0,0.08);
        }
        .tag.yi {
            background: #E8F8F5; color: #1ABC9C;
            box-shadow: 2px 2px 6px rgba(26, 188, 156, 0.15), -1px -1px 3px rgba(255,255,255,0.8);
        }
        .tag.ji {
            background: #FDEDEC; color: #E74C3C;
            box-shadow: 2px 2px 6px rgba(231, 76, 60, 0.15), -1px -1px 3px rgba(255,255,255,0.8);
        }

        .yi-ji-text {
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
        }

        .history-card {
            flex: 0.6;
            display: flex;
            flex-direction: column;
        }
        .history-content {
            flex: 1;
            font-size: 17px;
            line-height: 1.6;
            color: #555;
            display: flex;
            align-items: center;
            text-align: justify;
        }
        .joke-tag { font-size: 14px; color: #aaa; margin-top: auto; text-align: right; font-style: italic; }

        /* --- ç¬¬ä¸‰æ’ï¼šä¸»è¦å†…å®¹ (å æ®å‰©ä½™æ‰€æœ‰ç©ºé—´) --- */
        .row-main {
            flex: 1; /* å…³é”®ï¼šè‡ªåŠ¨å¡«å……å‰©ä½™é«˜åº¦ */
            display: flex;
            gap: var(--spacing);
            /* min-height: 0;  Removed to allow growth */
        }

        .news-card {
            flex: 0.55;
            display: flex;
            flex-direction: column;
        }
        .news-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* å‡åŒ€åˆ†å¸ƒ */
            list-style: none;
        }
        .news-item {
            font-size: 15px;
            padding-bottom: 8px;
            margin-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
        }
        .news-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .news-num {
            color: var(--accent-blue-text); font-size: 14px; width: 1.5em; flex-shrink: 0; font-weight: 800;
            font-family: var(--font-number);
            /* åºå·å¾®é˜´å½± */
            text-shadow: 0 1px 2px rgba(46, 134, 193, 0.15);
        }
        .news-text {
            color: #444;
            /* å–æ¶ˆæˆªæ–­ï¼Œæ˜¾ç¤ºå®Œæ•´å†…å®¹ */
            line-height: 1.4;
        }

        .news-footer {
            margin-top: 12px;
            padding-top: 8px;
            border-top: 1px dashed rgba(0,0,0,0.1);
            text-align: right;
            font-size: 10px;
            color: var(--text-light);
            font-family: var(--font-number);
        }

        /* å³ä¾§åˆ—å®¹å™¨ */
        .col-right {
            flex: 0.45;
            display: flex;
            flex-direction: column;
            gap: var(--spacing);
            min-width: 0;
        }

        /* å¤§ç›˜æŒ‡æ•°å¡ç‰‡ */
        .market-card {
            background: #FFFFFF;
            display: flex;
            flex-direction: column;
        }
        .market-list {
            display: flex;
            flex-direction: column;
            gap: 0;
            padding: 4px 0;
            list-style: none;
            margin: 0;
        }
        .market-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            line-height: 1.4;
            padding: 10px 4px;
            border-bottom: 1px dashed rgba(0,0,0,0.06);
        }
        .market-item:last-child {
            border-bottom: none;
        }
        .market-name {
            color: #64748b;
            font-weight: 500;
            font-size: 14px;
            font-family: 'Noto Sans SC', sans-serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }
        .market-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .market-value {
            font-family: 'JetBrains Mono', var(--font-number);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 15px;
            letter-spacing: -0.03em;
            font-variant-numeric: tabular-nums;
        }
        .market-change {
            font-family: var(--font-number);
            font-weight: 600;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 6px;
            min-width: 64px;
            text-align: center;
            display: inline-block;
        }
        .trend-up {
            color: var(--color-up);
            background-color: var(--color-up-bg);
        }
        .trend-down {
            color: var(--color-down);
            background-color: var(--color-down-bg);
        }
        .trend-flat {
            color: var(--color-flat);
            background-color: var(--color-flat-bg);
        }
        /* ä¼‘å¸‚è¡Œæ ·å¼ */
        .market-item.closed {
            opacity: 0.6;
        }
        .market-item.closed .market-name {
            color: var(--text-light);
        }
        .market-item.closed .market-value {
            color: var(--text-light);
        }
        .closed-badge {
            font-size: 12px;
            color: var(--text-light);
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 6px;
            min-width: 64px;
            text-align: center;
            display: inline-block;
            font-family: var(--font-body);
        }
        .market-footer {
            margin-top: 12px;
            text-align: right;
            font-size: 11px;
            color: #BDC3C7;
            font-family: var(--font-number);
        }
        .market-closed {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 0;
            color: var(--text-grey);
            text-align: center;
            background: radial-gradient(circle, #F7F9F9 0%, #fff 70%);
            border-radius: 12px;
            margin: 10px 0;
        }
        .market-closed-icon {
            font-size: 42px;
            margin-bottom: 10px;
            opacity: 0.8;
            filter: grayscale(0.5);
        }
        .market-closed-text {
            font-family: var(--font-title);
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 4px;
            font-weight: bold;
        }
        .market-closed-desc {
            font-family: var(--font-title);
            font-size: 14px;
            color: var(--text-grey);
            opacity: 0.8;
        }

        .holiday-card {
            flex: 1; /* åœ¨ col-right ä¸­å¡«å……å‰©ä½™ç©ºé—´ */
            background-color: #FFFFFF; /* ç™½è‰²èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            overflow: hidden;  /* é˜²æ­¢æº¢å‡º */
        }
        .holiday-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px; /* å‡å°é—´è·é€‚é…æ›´å¤šæ¡ç›® */
            overflow: hidden;  /* è¶…å‡ºéšè— */
        }
        .holiday-item {
            padding: 6px 12px; /* è°ƒæ•´å†…è¾¹è· */
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease-in-out;
            border-left: 3px solid transparent; /* é»˜è®¤é€æ˜è¾¹æ¡†å ä½ */
            /* èŠ‚å‡æ—¥å¡ç‰‡é˜´å½± */
            box-shadow: 2px 2px 6px rgba(0,0,0,0.04), -1px -1px 4px rgba(255,255,255,0.6);
        }
        /* æ³•å®šèŠ‚å‡æ—¥ - çªå‡º */
        .holiday-item.legal {
            background: linear-gradient(135deg, #FFF5E6 0%, #FFEDD5 100%);
            border-left: 3px solid #E67E22;
            box-shadow:
                3px 3px 10px rgba(230, 126, 34, 0.15),
                -2px -2px 6px rgba(255,255,255,0.8);
        }
        /* éæ³•å®šèŠ‚å‡æ—¥ - æ·¡åŒ– */
        .holiday-item.normal {
            background: #F8F9F9;
            opacity: 0.8;
            box-shadow: 1px 1px 4px rgba(0,0,0,0.03);
        }
        .h-info { display: flex; flex-direction: column; justify-content: center; }
        .h-name { font-size: 16px; font-weight: 700; color: #333; }
        .holiday-item.normal .h-name { font-weight: 500; color: #555;}
        .h-date { font-size: 11px; color: #999; margin-top: 2px; }

        .h-count-wrap { text-align: right; }
        .h-num {
            font-size: 27px; font-weight: 800;
            font-family: var(--font-number);
            /* å€’è®¡æ—¶æ•°å­—é˜´å½± */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        .h-unit {
            font-size: 9px; color: var(--text-light);
            font-family: var(--font-number);
        }

        /* å€’è®¡æ—¶é¢œè‰² */
        .h-num.urgent {
            color: #E74C3C;
            text-shadow: 1px 1px 4px rgba(231, 76, 60, 0.25);
        }  /* â‰¤7å¤© çº¢è‰² */
        .h-num.soon {
            color: #E67E22;
            text-shadow: 1px 1px 4px rgba(230, 126, 34, 0.25);
        }    /* 7-30å¤© æ©™è‰² */
        .h-num.later { color: #2C3E50; }   /* >30å¤© æ·±ç°è‰² */
        .holiday-item.normal .h-num { color: #95A5A6; text-shadow: none; } /* éæ³•å®šå‡æ—¥ç»Ÿä¸€ç”¨æµ…è‰² */
        /* èŠ‚å‡æ—¥å½“å¤©æ ·å¼ */
        .h-num.today { font-size: 24px; color: #E74C3C; }

        /* èŠ‚å‡æ—¥å½“å¤©å¡ç‰‡æ ·å¼ - çŠç‘šçº¢ï¼Œæ¬¢å¿«å–œåº† */
        .holiday-item.is-today {
            background: linear-gradient(135deg, #F1948A 0%, #E74C3C 100%);
            border: none;
            border-left: none;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
            transform: translateY(-1px);
        }
        .holiday-item.is-today .h-name,
        .holiday-item.is-today .h-num.today,
        .holiday-item.is-today .h-unit {
            color: white;
        }
        .holiday-item.is-today .h-date {
            color: rgba(255, 255, 255, 0.9);
        }
        .holiday-item.is-today .h-name {
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .holiday-item.is-today .h-unit {
            font-weight: 600;
            font-size: 11px;
        }

        /* è¡¥ç­æ—¥åŸºç¡€æ ·å¼ */
        .holiday-item.workday {
            background: #F0F3F4;
            border-left: 3px solid #7F8C8D;
            color: #566573;
        }

        /* è¡¥ç­æ—¥å½“å¤©æ ·å¼ - æµ…ç°è“ï¼Œæ²‰ç¨³å†·é™ */
        .holiday-item.workday.is-today {
            background: linear-gradient(135deg, #BDC3C7 0%, #7F8C8D 100%);
            border: none;
            border-left: none;
            box-shadow: 0 4px 12px rgba(127, 140, 141, 0.3);
            transform: translateY(-1px);
        }

        .holiday-item.workday.is-today .h-name,
        .holiday-item.workday.is-today .h-date,
        .holiday-item.workday.is-today .h-num,
        .holiday-item.workday.is-today .h-unit {
            color: #FFFFFF;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .holiday-item.workday .h-name {
            color: #34495E;
        }

        /* é¡µè„šæ•´ä½“å®¹å™¨ */
        .footer-wrapper {
            margin-top: auto;
            width: 100%;
            padding-top: 14px;
            border-top: 1px solid rgba(0,0,0,0.06);
            font-family: var(--font-body);
        }

        /* æŠ€æœ¯å…ƒæ•°æ® */
        .footer-secondary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 9px;
            color: var(--text-light);
            letter-spacing: 0.03em;
            opacity: 0.9;
        }
        .footer-secondary > span {
            overflow-wrap: anywhere;
        }

        /* --- ç¬¬å››æ’ï¼šç‰¹è‰²æ¿å— (ç–¯ç‹‚æ˜ŸæœŸå››) --- */
        .row-special {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            background: #FFFFFF;
            border-radius: var(--card-radius);
            padding: 20px;
            /* KFC å¡ç‰‡æ–°æ‹Ÿæ€é˜´å½± */
            box-shadow:
                6px 6px 14px rgba(192, 57, 43, 0.1),
                -4px -4px 10px rgba(255,255,255,0.9),
                inset 0 1px 0 rgba(255,255,255,0.5);
            border: 1px solid rgba(255,255,255,0.8);
            /* ç¨å¾®åŠ ä¸€ç‚¹çº¢è‰²æ°›å›´ */
            background: linear-gradient(135deg, #fffcfc 0%, #fff5f5 100%);
            border-left: 4px solid #C0392B; /* è‚¯å¾·åŸºçº¢ */
            margin-bottom: 8px;
        }

        .kfc-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            border-bottom: 1px dashed rgba(192, 57, 43, 0.2);
            padding-bottom: 10px;
        }

        .kfc-icon {
            font-size: 28px;
            background: #FDEDEC;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            /* å›¾æ ‡é˜´å½± */
            box-shadow:
                3px 3px 8px rgba(192, 57, 43, 0.15),
                -2px -2px 6px rgba(255,255,255,0.8);
        }

        .kfc-titles {
            display: flex;
            flex-direction: column;
        }

        .kfc-title-en {
            font-size: 18px;
            font-weight: 900;
            color: #C0392B;
            letter-spacing: 1px;
            font-family: var(--font-number);
            line-height: 1;
            /* KFC æ ‡é¢˜é˜´å½± */
            text-shadow: 1px 1px 3px rgba(192, 57, 43, 0.2);
        }

        .kfc-title-cn {
            font-size: 12px;
            color: #E74C3C;
            letter-spacing: 4px;
            font-weight: bold;
            margin-top: 4px;
        }

        .kfc-body {
            font-size: 14px;
            line-height: 1.5;
            color: #555;
            text-align: justify;
            /* ç§»é™¤é«˜åº¦é™åˆ¶ï¼Œå®Œæ•´æ˜¾ç¤ºå†…å®¹ */
            font-style: italic;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* å“åº”å¼å¸ƒå±€ - ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            .row-main {
                flex-direction: column;
            }
            .news-card {
                flex: 1;
            }
            .col-right {
                flex: 1;
                flex-direction: column;
            }
            .market-card,
            .holiday-card {
                flex: 1 1 100%;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            body { background: white; height: auto; overflow: visible; }
            .poster {
                width: 100%; height: 100%;
                box-shadow: none; padding: 0;
                aspect-ratio: auto;
            }
            .box { border: 1px solid #ddd; }
            /* é¡µè„šæ‰“å°é€‚é… */
            .footer-secondary {
                font-size: 10px;
                color: #666;
            }
            /* æ–°é—»åº•éƒ¨æ—¶é—´æ‰“å°é€‚é… */
            .news-footer {
                font-size: 11px;
                color: var(--text-dark);
                border-top-color: rgba(0,0,0,0.3);
            }
        }
    </style>
</head>
<body>

    <div class="poster">

        <!-- ç¬¬ä¸€æ’ï¼šæ ‡é¢˜ä¸æ—¥æœŸ -->
        <div class="row-header">
            <div class="box title-card">
                <div class="moyu-text">æ‘¸é±¼<br>æ—¥å†</div>
                <div class="moyu-sub">MOYU CALENDAR</div>
            </div>
            <div class="box date-card">
                <div class="date-left">
                    <div class="ym-text">{{ date.year_month }}</div>
                    <div class="big-day">{{ date.day }}</div>
                </div>
                <div class="date-right">
                    <div class="week-pill">{{ date.week_cn }} Â· {{ date.week_en }}</div>
                    <div class="lunar-text">å†œå† {{ date.lunar_year }}</div>
                    <div class="lunar-text">{{ date.lunar_date }}</div>
                    {% if weekend.is_weekend %}
                    <div class="weekend-wrap is-weekend" role="img" aria-label="ä»Šæ—¥å‘¨æœ«ï¼Œå°½æƒ…ä¼‘æ¯">
                        ğŸ‰ å‘¨æœ«æ„‰å¿«ï¼Œæ‘¸é±¼æ— ç½ªï¼
                    </div>
                    {% else %}
                    <div class="weekend-wrap">
                        â³ è·å‘¨æœ«è¿˜æœ‰ <span class="weekend-num">{{ weekend.days_left }}</span> å¤©
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒæ’ï¼šèŠ‚æ°”ä¸å®œå¿Œ -->
        <div class="row-info">
            <div class="box term-card">
                <h2>ğŸŒ¿ ä¸‹ä¸ªèŠ‚æ°”</h2>
                <div class="countdown-wrap">
                    <div class="term-name-cn">{{ solar_term.name }}</div>
                    <div class="term-name-en">{{ solar_term.name_en }}</div>
                    {% if solar_term.is_today %}
                    <div class="days-label today">ä»Šæ—¥ {{ solar_term.name }}ï¼Œé¡ºåº”å¤©æ—¶</div>
                    {% else %}
                    <div class="days-label">è¿˜æœ‰ <span class="days-num">{{ solar_term.days_left }}</span> å¤©</div>
                    {% endif %}
                </div>
                <div class="yi-ji-row">
                    <div><span class="tag yi">å®œ</span><span class="yi-ji-text">{% for item in guide.yi %}{{ item }} {% endfor %}</span></div>
                    <div><span class="tag ji">å¿Œ</span><span class="yi-ji-text">{% for item in guide.ji %}{{ item }} {% endfor %}</span></div>
                </div>
            </div>
            <div class="box history-card">
                <h2>{{ history.title }}</h2>
                <div class="history-content">{{ history.content }}</div>
                <div class="joke-tag">â€”â€” æ‘¸é±¼åŠå®£</div>
            </div>
        </div>

        <!-- ç¬¬ä¸‰æ’ï¼šæ–°é—»ä¸å‡æœŸ -->
        <div class="row-main">
            <div class="box news-card">
                <h2>ğŸ“° æ¯æ—¥ 60s é€Ÿè§ˆ</h2>
                <ul class="news-list" id="news-list">
                    {% for item in news_list %}
                    <li class="news-item"><span class="news-num">{{ item.num }}</span><span class="news-text">{{ item.text }}</span></li>
                    {% endfor %}
                </ul>
                {% if news_meta and news_meta.updated %}
                <div class="news-footer">
                    æ•°æ®æ›´æ–°äº {{ news_meta.updated | format_datetime }}
                </div>
                {% endif %}
            </div>

            <!-- å³ä¾§åˆ—ï¼šå¤§ç›˜æŒ‡æ•° + å‡æœŸç›¼å¤´ -->
            <div class="col-right">
                <!-- å¤§ç›˜æŒ‡æ•° -->
                <div class="box market-card">
                    <h2><span role="img" aria-label="è‚¡ç¥¨">ğŸ“ˆ</span> å¤§ç›˜æŒ‡æ•°</h2>
                    {% if stock_indices and stock_indices.indices %}
                    <ul class="market-list" role="list" aria-label="å¤§ç›˜æŒ‡æ•°åˆ—è¡¨">
                        {% for index in stock_indices.indices %}
                        <li class="market-item{{ ' closed' if not index.is_trading_day else '' }}">
                            <span class="market-name">{{ index.name }}</span>
                            <div class="market-right">
                                <span class="market-value">{{ index.price if index.price else '--' }}</span>
                                {% if index.is_trading_day %}
                                <span class="market-change trend-{{ index.trend }}">{{ index.change_pct }}</span>
                                {% else %}
                                <span class="closed-badge">ä¼‘å¸‚</span>
                                {% endif %}
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% if stock_indices.updated %}
                    <div class="market-footer">æ•°æ®æ›´æ–°: {{ stock_indices.updated | format_datetime }}</div>
                    {% endif %}
                    {% else %}
                    <div class="market-closed">
                        <span class="market-closed-icon" role="img" aria-label="å’–å•¡">â˜•ï¸</span>
                        <div class="market-closed-text">ä»Šæ—¥ä¼‘å¸‚</div>
                        <div class="market-closed-desc">æŠ›å¼€Kçº¿ï¼Œäº«å—ç”Ÿæ´»</div>
                    </div>
                    {% endif %}
                </div>

                <!-- å‡æœŸç›¼å¤´ -->
                <div class="box holiday-card">
                    <h2>ğŸ–ï¸ å‡æœŸç›¼å¤´</h2>
                    <div class="holiday-list">
                        {% for holiday in holidays %}
                        <div class="holiday-item {{ 'workday' if holiday.is_off_day is false else ('legal' if holiday.is_legal_holiday else 'normal') }}{{ ' is-today' if holiday.days_left == 0 else '' }}">
                            <div class="h-info">
                                <div class="h-name">
                                    {% if holiday.is_off_day is false %}<span role="img" aria-label="è¡¥ç­">ğŸ’¼</span> {% elif holiday.is_legal_holiday %}<span role="img" aria-label="æ³•å®šå‡æ—¥">ğŸ‰</span> {% endif %}{{ holiday.name }}
                                </div>
                                <div class="h-date">
                                    {{ holiday.start_date }}
                                    {% if holiday.duration > 1 %}
                                    ~ {{ holiday.end_date }} ({{ holiday.duration }}å¤©)
                                    {% endif %}
                                </div>
                            </div>
                            <div class="h-count-wrap">
                                {% if holiday.days_left == 0 %}
                                    {% if holiday.is_off_day is false %}
                                    <div class="h-num today" role="img" aria-label="ä»Šæ—¥è¡¥ç­">ğŸ˜­</div>
                                    <div class="h-unit">è¡¥ç­ä¸­</div>
                                    {% else %}
                                    <div class="h-num today" role="img" aria-label="ä»Šæ—¥å‡æœŸ">ğŸ¥³</div>
                                    <div class="h-unit">å‡æœŸä¸­</div>
                                    {% endif %}
                                {% else %}
                                <div class="h-num {% if holiday.is_legal_holiday %}{% if holiday.days_left <= 7 %}urgent{% elif holiday.days_left <= 30 %}soon{% else %}later{% endif %}{% endif %}">{{ holiday.days_left }}</div>
                                <div class="h-unit">DAYS</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¬¬å››æ’ï¼šç–¯ç‹‚æ˜ŸæœŸå›› (ä»…å‘¨å››æ˜¾ç¤º) -->
        {% if kfc_content %}
        <div class="row-special kfc-card">
            <div class="kfc-header">
                <div class="kfc-icon">ğŸ—</div>
                <div class="kfc-titles">
                    <div class="kfc-title-en">{{ kfc_content.title }}</div>
                    <div class="kfc-title-cn">{{ kfc_content.sub_title }}</div>
                </div>
            </div>
            <div class="kfc-body">{{ kfc_content.content }}</div>
        </div>
        {% endif %}

        <!-- é¡µè„šåŒºåŸŸ -->
        <div class="footer-wrapper">
            <div class="footer-secondary">
                <span>{{ github_url | default('MR-MonkeyRay/moyuren_server') }}</span>
                <span>{{ version | default('v0.1.0') }}</span>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const holidayList = document.querySelector('.holiday-list');
            if (!holidayList) return;

            const holidayItems = Array.from(holidayList.children);
            if (holidayItems.length === 0) return;

            const setVisibleHolidays = () => {
                // Reset display for all items for recalculation
                holidayItems.forEach(item => item.style.display = '');

                const listMaxHeight = holidayList.clientHeight;
                const listGap = parseFloat(window.getComputedStyle(holidayList).gap) || 0;
                let accumulatedHeight = 0;

                for (let i = 0; i < holidayItems.length; i++) {
                    const item = holidayItems[i];
                    const itemHeight = item.offsetHeight;
                    
                    let heightWithGap = itemHeight;
                    if (i > 0) {
                        heightWithGap += listGap;
                    }

                    // Use a small buffer (1px) to prevent floating point inaccuracies
                    if (accumulatedHeight + heightWithGap > listMaxHeight + 1) {
                        for (let j = i; j < holidayItems.length; j++) {
                            holidayItems[j].style.display = 'none';
                        }
                        break;
                    }
                    accumulatedHeight += heightWithGap;
                }
            };

            const run = () => {
                // Wait for fonts to load before calculating heights
                // Fallback to rAF for older browsers without FontFaceSet API
                if (document.fonts && document.fonts.ready) {
                    document.fonts.ready.then(() => {
                        requestAnimationFrame(setVisibleHolidays);
                    });
                } else {
                    requestAnimationFrame(() => {
                        requestAnimationFrame(setVisibleHolidays);
                    });
                }
            };

            run();

            // Re-run on window resize, debounced
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(run, 150);
            });
        });
    </script>
</body>
</html>
